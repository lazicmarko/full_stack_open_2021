(this["webpackJsonpbloglist-frontend"]=this["webpackJsonpbloglist-frontend"]||[]).push([[0],{44:function(e,t,n){},45:function(e,t,n){"use strict";n.r(t);var r=n(1),a=n(19),s=n.n(a),c=n(2),o=n.n(c),i=n(5),u=n(3),l=n(10),d=n(0),b=function(e){var t=e.blog,n=e.user,a=e.handleLike,s=e.handleRemove,c=Object(r.useState)(!1),o=Object(u.a)(c,2),i=o[0],l=o[1],b={display:i?"":"none"};return Object(d.jsxs)("div",{style:{paddingTop:10,paddingLeft:2,border:"solid",borderWidth:1,marginBottom:5},className:"blog",children:[Object(d.jsxs)("div",{className:"blog-heading",children:[t.title," - ",t.author," - ",Object(d.jsx)("button",{className:"view-button",onClick:function(){return l(!i)},children:i?"hide":"view"})]}),Object(d.jsxs)("div",{style:b,className:"blog-details",children:[Object(d.jsx)("div",{className:"url",children:t.url}),Object(d.jsxs)("div",{className:"likes",children:["likes ",t.likes," ",Object(d.jsx)("button",{className:"like-button",onClick:function(){return a(t.id)},children:"like"})]}),Object(d.jsx)("div",{children:t.user.name}),n.username===t.user.username&&Object(d.jsx)("button",{className:"remove-btn",onClick:function(){return s(t.id)},children:"remove"})]})]})},j=n(6),p=n.n(j),f="/api/blogs",v=null,h={getAll:function(){return p.a.get(f).then((function(e){return e.data}))},create:function(){var e=Object(i.a)(o.a.mark((function e(t){var n,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={headers:{authorization:v}},e.next=3,p.a.post(f,t,n);case 3:return r=e.sent,e.abrupt("return",r.data);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),setToken:function(e){v="bearer ".concat(e)},update:function(){var e=Object(i.a)(o.a.mark((function e(t){var n,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={headers:{authorization:v}},e.next=3,p.a.put("".concat(f,"/").concat(t.id),t,n);case 3:return r=e.sent,e.abrupt("return",r.data);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),remove:function(){var e=Object(i.a)(o.a.mark((function e(t){var n,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={headers:{authorization:v}},e.next=3,p.a.delete("".concat(f,"/").concat(t),n);case 3:return r=e.sent,e.abrupt("return",r.data);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()};var g=function(e){var t=e.blogs,n=e.setBlogs,r=e.user,a=e.setMessage,s=e.resetMessage,c=function(){var e=Object(i.a)(o.a.mark((function e(r){var c,i,u;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=t.find((function(e){return e.id===r})),e.prev=1,e.next=4,h.update({id:c.id,title:c.title,author:c.author,url:c.url,likes:c.likes+1});case 4:i=e.sent,(u=Object(l.a)(t))[u.indexOf(c)]=i,n(u),a({text:"".concat(c.title," liked"),classname:"success"}),s(),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(1),a({text:e.t0.response.data.error,classname:"error"}),s();case 16:case"end":return e.stop()}}),e,null,[[1,12]])})));return function(t){return e.apply(this,arguments)}}(),u=function(){var e=Object(i.a)(o.a.mark((function e(r){var c,i,u;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=t.find((function(e){return e.id===r})),console.log(c),!window.confirm("Remove blog ".concat(c.title,"! by ").concat(c.author))){e.next=18;break}return e.prev=3,e.next=6,h.remove(c.id);case 6:i=e.sent,console.log(i,"removed"),u=Object(l.a)(t),n(u.filter((function(e){return e.id!==c.id}))),a({text:"".concat(c.title," removed"),classname:"success"}),s(),e.next=18;break;case 14:e.prev=14,e.t0=e.catch(3),a({text:e.t0.response.data.error,classname:"error"}),s();case 18:case"end":return e.stop()}}),e,null,[[3,14]])})));return function(t){return e.apply(this,arguments)}}();return Object(d.jsx)("div",{id:"bloglist",children:t.sort((function(e,t){return t.likes-e.likes})).map((function(e){return Object(d.jsx)(b,{blog:e,user:r,resetMessage:s,setMessage:a,handleLike:c,handleRemove:u},e.id)}))})},O=function(e){var t=e.username,n=e.password,r=e.setUsername,a=e.setPassword,s=e.handleLogin;return Object(d.jsxs)("div",{children:[Object(d.jsx)("h2",{children:"Log in to application"}),Object(d.jsxs)("form",{onSubmit:s,children:[Object(d.jsxs)("div",{children:["username",Object(d.jsx)("input",{type:"text",value:t,id:"username",onChange:function(e){var t=e.target;return r(t.value)}})]}),Object(d.jsxs)("div",{children:["password",Object(d.jsx)("input",{type:"password",value:n,id:"password",onChange:function(e){var t=e.target;return a(t.value)}})]}),Object(d.jsx)("button",{id:"login-button",type:"submit",children:"login"})]})]})},x=function(e){var t=e.blogs,n=e.setBlogs,a=e.setMessage,s=e.resetMessage,c=e.blogFormRef,l=Object(r.useState)(""),b=Object(u.a)(l,2),j=b[0],p=b[1],f=Object(r.useState)(""),v=Object(u.a)(f,2),g=v[0],O=v[1],x=Object(r.useState)(""),m=Object(u.a)(x,2),w=m[0],k=m[1],y=function(){var e=Object(i.a)(o.a.mark((function e(r){var i;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.preventDefault(),e.prev=1,e.next=4,h.create({title:j,author:g,url:w});case 4:i=e.sent,c.current.toggleVisibility(),O(""),p(""),k(""),n(t.concat(i)),a({text:"A new blog ".concat(i.title," by ").concat(i.author," added."),classname:"success"}),s(),e.next=19;break;case 14:e.prev=14,e.t0=e.catch(1),a({text:e.t0.response.data.error,classname:"error"}),console.log(e.t0.response.data),s();case 19:case"end":return e.stop()}}),e,null,[[1,14]])})));return function(t){return e.apply(this,arguments)}}();return Object(d.jsxs)("div",{children:[Object(d.jsx)("h2",{children:"Create new"}),Object(d.jsxs)("form",{onSubmit:y,children:[Object(d.jsxs)("div",{children:["title:",Object(d.jsx)("input",{id:"title",type:"text",value:j,onChange:function(e){var t=e.target;return p(t.value)}})]}),Object(d.jsxs)("div",{children:["author:",Object(d.jsx)("input",{id:"author",type:"text",value:g,onChange:function(e){var t=e.target;return O(t.value)}})]}),Object(d.jsxs)("div",{children:["url:",Object(d.jsx)("input",{id:"url",type:"text",value:w,onChange:function(e){var t=e.target;return k(t.value)}})]}),Object(d.jsx)("button",{id:"create-blog-button",type:"submit",children:"create"})]})]})},m=function(e){var t=e.message;return null===t?null:Object(d.jsx)("div",{className:t.classname,children:t.text})},w=Object(r.forwardRef)((function(e,t){var n=Object(r.useState)(!1),a=Object(u.a)(n,2),s=a[0],c=a[1],o={display:s?"none":""},i={display:s?"":"none"},l=function(){c(!s)};return Object(r.useImperativeHandle)(t,(function(){return{toggleVisibility:l}})),Object(d.jsxs)("div",{children:[Object(d.jsx)("div",{style:o,children:Object(d.jsx)("button",{onClick:l,children:e.buttonLabel})}),Object(d.jsxs)("div",{style:i,children:[e.children,Object(d.jsx)("button",{onClick:l,children:"cancel"})]})]})}));w.displayName="Togglable";var k=w,y={login:function(){var e=Object(i.a)(o.a.mark((function e(t){var n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.a.post("api/login",t);case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},S=function(){var e=Object(r.useState)([]),t=Object(u.a)(e,2),n=t[0],a=t[1],s=Object(r.useState)(""),c=Object(u.a)(s,2),l=c[0],b=c[1],j=Object(r.useState)(""),p=Object(u.a)(j,2),f=p[0],v=p[1],w=Object(r.useState)(null),S=Object(u.a)(w,2),C=S[0],N=S[1],M=Object(r.useState)(null),L=Object(u.a)(M,2),B=L[0],R=L[1],T=Object(r.useRef)();Object(r.useEffect)((function(){h.getAll().then((function(e){return a(e)})).catch((function(e){R({text:"Could not connect to server",classname:"error"}),console.log(e),I()}))}),[]),Object(r.useEffect)((function(){var e=window.localStorage.getItem("loggedUser");if(e){var t=JSON.parse(e);N(t),h.setToken(t.token)}}),[]);var I=function(){return setTimeout((function(){return R(null)}),5e3)},U=function(){var e=Object(i.a)(o.a.mark((function e(t){var n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.prev=1,e.next=4,y.login({username:l,password:f});case 4:n=e.sent,window.localStorage.setItem("loggedUser",JSON.stringify(n)),h.setToken(n.token),N(n),R({text:"Welcome ".concat(n.name),classname:"success"}),I(),b(""),v(""),e.next=18;break;case 14:e.prev=14,e.t0=e.catch(1),R({text:e.t0.response.data.error,classname:"error"}),I();case 18:case"end":return e.stop()}}),e,null,[[1,14]])})));return function(t){return e.apply(this,arguments)}}();return Object(d.jsxs)("div",{children:[Object(d.jsx)("h1",{children:"Bloglist app"}),Object(d.jsx)(m,{message:B}),null===C?Object(d.jsx)(k,{buttonLabel:"login",children:Object(d.jsx)(O,{username:l,setUsername:b,password:f,setPassword:v,handleLogin:U})}):Object(d.jsxs)("div",{children:[Object(d.jsxs)("div",{children:[C.name," logged in",Object(d.jsx)("button",{onClick:function(){window.localStorage.removeItem("loggedUser"),N(null),R({text:"Successfully logged out",classname:"success"}),I()},children:"logout"})]}),Object(d.jsx)(k,{buttonLabel:"new blog",ref:T,children:Object(d.jsx)(x,{blogs:n,setBlogs:a,setMessage:R,resetMessage:I,blogFormRef:T})}),Object(d.jsx)(g,{blogs:n,setBlogs:a,user:C,setMessage:R,resetMessage:I})]})]})};n(44);s.a.render(Object(d.jsx)(S,{}),document.getElementById("root"))}},[[45,1,2]]]);
//# sourceMappingURL=main.982238c0.chunk.js.map